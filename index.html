<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Supply Chain Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f9fafb; }
  #date { margin-bottom: 20px; font-size: 18px; font-weight: bold; }
  #chartsContainer { display: flex; flex-direction: column; gap: 30px; }

  .chart-unit { 
    display: flex; 
    flex-direction: column; 
    gap: 8px; 
    background: #fff; 
    padding: 15px; 
    border-radius: 8px; 
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }

  .chart-unit div { font-size: 14px; }
  .flex { display: flex; align-items: center; }
  .flex-1 { flex: 1; }
  .gap-3 { gap: 0.5rem; }
  .mb-1 { margin-bottom: 0.2rem; }
  .font-medium { font-weight: 500; }
  .font-semibold { font-weight: 600; }
  .text-lg { font-size: 1rem; }
  .w-4 { width: 0.8rem; }
  .h-4 { height: 0.8rem; }
  .rounded-sm { border-radius: 0.125rem; }
  canvas { width: 100% !important; height: 300px !important; }
</style>
</head>
<body>

<div id="date"></div>

<div id="chartsContainer">

  <div class="chart-unit" data-chart="segmentBarChart"></div>
  <div class="chart-unit" data-chart="segmentPieChart"></div>
  <div class="chart-unit" data-chart="plannedPieChart"></div>
  <div class="chart-unit" data-chart="statusBarChart"></div>
  <div class="chart-unit" data-chart="stateBarChart"></div>

</div>

<script>
document.getElementById('date').textContent = new Date().toLocaleDateString();
const COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6'];

/* Data */
const segmentData = {labels:['Downstream','Midstream','Other - Equipment','Other - Research','Upstream','Other - Service & Repair','Other','Other - Modeling/Software','Under Construction'], values:[370,270,143,130,94,90,57,36,1]};
const plannedData = {labels:['Downstream','Midstream','Other','Other - Equipment','Other - Research','Other - Service & Repair','Upstream'], values:[45,76,4,1,4,2,38]};
const statusData = {labels:['Commercial','Planned','Pre-commercial/startup','Under construction','Cancelled','Bankrupt','Under Construction','Paused construction'], values:[802,170,129,59,21,4,3,3]};
const stateLabels = ['CA','MI','TX','MA','ON','QC','OH','NY','PA','NC','Others'];
const stateValues = [165,98,59,53,51,47,43,42,40,37, 1191-(165+98+59+53+51+47+43+42+40+37)];

/* Chart config functions */
function createChart(id) {
  const ctx = document.createElement('canvas');
  ctx.id = id;
  document.querySelector(`[data-chart="${id}"]`).appendChild(ctx);

  switch(id){
    case 'segmentBarChart': return new Chart(ctx, {type:'bar', data:{labels:segmentData.labels,datasets:[{data:segmentData.values,backgroundColor:COLORS}]}, options:{plugins:{legend:{display:false},title:{display:true,text:'Companies by Supply Chain Segment',font:{size:18}}},responsive:true,maintainAspectRatio:false}});
    case 'segmentPieChart': return new Chart(ctx, {type:'pie', data:{labels:segmentData.labels,datasets:[{data:segmentData.values,backgroundColor:COLORS}]}, options:{plugins:{legend:{display:false},title:{display:true,text:'Supply Chain Segment Distribution',font:{size:18}}},responsive:true,maintainAspectRatio:false}});
    case 'plannedPieChart': return new Chart(ctx, {type:'pie', data:{labels:plannedData.labels,datasets:[{data:plannedData.values,backgroundColor:COLORS}]}, options:{plugins:{legend:{display:false},title:{display:true,text:'Planned Projects by Supply Chain Segment',font:{size:18}}},responsive:true,maintainAspectRatio:false}});
    case 'statusBarChart': return new Chart(ctx, {type:'bar', data:{labels:statusData.labels,datasets:[{data:statusData.values,backgroundColor:COLORS}]}, options:{plugins:{legend:{display:false},title:{display:true,text:'Project Status Distribution',font:{size:18}}},responsive:true,maintainAspectRatio:false,scales:{x:{ticks:{maxRotation:45,minRotation:45}}}}});
    case 'stateBarChart': return new Chart(ctx, {type:'bar', data:{labels:stateLabels,datasets:[{data:stateValues,backgroundColor:'#10b981'}]}, options:{indexAxis:'y',plugins:{legend:{display:false},title:{display:true,text:'Top States/Provinces by Facility Count',font:{size:18}}},responsive:true,maintainAspectRatio:false}});
  }
}

/* Lazy load charts on scroll */
const observer = new IntersectionObserver((entries, obs)=>{
  entries.forEach(e=>{
    if(e.isIntersecting){
      createChart(e.target.dataset.chart);
      obs.unobserve(e.target);
    }
  });
},{threshold:0.3});

document.querySelectorAll('.chart-unit').forEach(el=>observer.observe(el));
</script>
</body>
</html>
