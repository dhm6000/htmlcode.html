<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Li-Ion Battery Supply Chain Dashboard</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  /* Improved chart sizing */
  .chart-container {
    position: relative;
    height: 300px;
    margin: 0 auto;
  }
  .chart-container-sm {
    height: 200px;
  }
  .chart-container-lg {
    height: 350px;
  }
  
  @media print {
    body { margin: 0; }
    .no-print { display: none !important; }
    .print-page { page-break-inside: avoid; break-inside: avoid; }
    @page { size: landscape; margin: 0.5in; }
    
    /* Ensure charts print properly */
    .chart-container, .chart-container-sm, .chart-container-lg {
      height: 250px !important;
      page-break-inside: avoid;
    }
  }
</style>
</head>

<body class="bg-slate-50 p-6">

<div class="max-w-4xl mx-auto space-y-6">

  <!-- Print Button + Title -->
  <div class="print-page">
    <div class="no-print mb-4 flex items-center gap-4">
      <button onclick="window.print()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition-colors">
        ðŸ“„ Save as PDF / Print
      </button>
      <div class="text-sm text-slate-600">Click to open print dialog, then select "Save as PDF"</div>
    </div>
    <h1 class="text-3xl font-bold text-slate-800 mb-1">Li-Ion Battery Supply Chain Dashboard</h1>
    <p class="text-sm text-slate-600">Comprehensive visualization of the North American battery supply chain ecosystem</p>
  </div>

  <!-- Key Stats -->
  <div class="grid grid-cols-1 sm:grid-cols-4 gap-4 print-page">
    <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-gray-400">
      <div class="text-2xl font-bold text-slate-800" id="totalFacilities">1191</div>
      <div class="text-slate-600 text-xs">Total Facilities</div>
    </div>
    <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-gray-400">
      <div class="text-2xl font-bold text-slate-800" id="commercialOps">802</div>
      <div class="text-slate-600 text-xs">Commercial Operations</div>
    </div>
    <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-gray-400">
      <div class="text-2xl font-bold text-slate-800" id="plannedProjects">170</div>
      <div class="text-slate-600 text-xs">Planned Projects</div>
    </div>
    <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-gray-400">
      <div class="text-2xl font-bold text-slate-800">50+</div>
      <div class="text-slate-600 text-xs">States/Provinces</div>
    </div>
  </div>

  <!-- Segment Bar -->
  <div class="bg-white rounded-lg shadow-md p-4 print-page">
    <h2 class="text-lg font-semibold text-slate-800 mb-3">Companies by Supply Chain Segment</h2>
    <div class="chart-container">
      <canvas id="segmentBarChart" aria-label="Companies by supply chain segment"></canvas>
    </div>
  </div>

  <!-- Segment Pie + Percent Table (two-column) -->
  <div class="bg-white rounded-lg shadow-md p-4 print-page">
    <h2 class="text-lg font-semibold text-slate-800 mb-3">Supply Chain Segment Distribution</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-start">
      <div class="chart-container-lg">
        <canvas id="segmentPieChart" aria-label="Supply chain segment pie chart"></canvas>
      </div>
      <div id="segmentTable" class="text-sm bg-slate-50 p-4 rounded-lg border border-slate-100"></div>
    </div>
  </div>

  <!-- Planned Projects Pie + Percent Table (two-column) -->
  <div class="bg-white rounded-lg shadow-md p-4 print-page">
    <h2 class="text-lg font-semibold text-slate-800 mb-3">Planned Projects by Supply Chain Segment</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-start">
      <div class="chart-container-lg">
        <canvas id="plannedPieChart" aria-label="Planned projects pie chart"></canvas>
      </div>
      <div id="plannedTable" class="text-sm bg-slate-50 p-4 rounded-lg border border-slate-100"></div>
    </div>
  </div>

  <!-- Status Bar -->
  <div class="bg-white rounded-lg shadow-md p-4 print-page">
    <h2 class="text-lg font-semibold text-slate-800 mb-3">Project Status Distribution</h2>
    <div class="chart-container">
      <canvas id="statusBarChart" aria-label="Project status distribution"></canvas>
    </div>
  </div>

  <!-- State Bar Horizontal -->
  <div class="bg-white rounded-lg shadow-md p-4 print-page">
    <h2 class="text-lg font-semibold text-slate-800 mb-3">Top States/Provinces by Facility Count</h2>
    <div class="chart-container-sm">
      <canvas id="stateBarChart" aria-label="Top states by facility count"></canvas>
    </div>
    <div class="mt-3 text-sm text-slate-600 bg-slate-50 p-3 rounded">
      <strong>Note:</strong> "Others" represents all additional states/provinces beyond the top 10.
    </div>
  </div>

  <!-- Footer -->
  <div class="bg-blue-50 rounded-lg p-4 border border-blue-200 print-page">
    <h3 class="font-semibold text-slate-800 mb-2">About this Data</h3>
    <p class="text-sm text-slate-600 mb-2">
      This dashboard visualizes data from the NAATBatt Lithium-Ion Battery Supply Chain Database.
      The full online database is available
      <a href="https://www.nrel.gov/transportation/li-ion-battery-supply-chain-database-online"
         class="text-blue-600 underline" target="_blank" rel="noopener noreferrer">NREL / NAATBatt Database</a>.
    </p>
    <p class="text-sm text-slate-600 mb-1">Use of this data requires Attribution to NREL and NAATBatt International.</p>
    <p class="text-xs text-slate-500 mt-2">Generated: <span id="date"></span></p>
  </div>

</div>

<script>
document.getElementById('date').textContent = new Date().toLocaleDateString();

/* Colors */
const COLORS = ['#3b82f6','#10b981','#f59e0b','#ef4444','#8b5cf6','#ec4899','#14b8a6'];

/* Data */
const segmentData = {
  labels: ['Downstream','Midstream','Other - Equipment','Other - Research','Upstream','Other - Service & Repair','Other','Other - Modeling/Software','Under Construction'],
  values: [370,270,143,130,94,90,57,36,1]
};
const plannedData = {
  labels: ['Downstream','Midstream','Other','Other - Equipment','Other - Research','Other - Service & Repair','Upstream'],
  values: [45,76,4,1,4,2,38]
};
const statusData = {
  labels: ['Commercial','Planned','Pre-commercial/startup','Under construction','Cancelled','Bankrupt','Under Construction','Paused construction'],
  values: [802,170,129,59,21,4,3,3]
};
const stateLabels = ['CA','MI','TX','MA','ON','QC','OH','NY','PA','NC','Others'];
const stateValues = [165,98,59,53,51,47,43,42,40,37, 1191-(165+98+59+53+51+47+43+42+40+37)];

/* Helper: generate color-coded percent table to a container */
function generatePercentTable(containerId, labels, values, startIndex = 0) {
  const total = values.reduce((a,b)=>a+b,0) || 1;
  const rows = labels.map((label, i) => {
    const val = values[i] || 0;
    const pct = ((val/total)*100).toFixed(1);
    const color = COLORS[(i + startIndex) % COLORS.length];
    return `
      <div class="flex items-center justify-between gap-4 mb-2">
        <div class="flex items-center gap-3">
          <div class="w-4 h-4 rounded-sm" style="background:${color}"></div>
          <div class="text-sm font-medium">${label}</div>
        </div>
        <div class="text-sm font-semibold">${pct}%</div>
      </div>
    `;
  }).join("");
  document.getElementById(containerId).innerHTML = `
    <div class="mb-2 text-slate-700 font-semibold">Distribution (color-coded)</div>
    <div>${rows}</div>
    <div class="mt-3 text-xs text-slate-500">Total: ${total.toLocaleString()}</div>
  `;
}

/* Charts - options optimized for proper sizing */
const baseOptions = {
  responsive: true,
  maintainAspectRatio: false,
  plugins: { 
    legend: { 
      display: false 
    } 
  },
  layout: { 
    padding: {
      top: 10,
      bottom: 10,
      left: 15,
      right: 15
    }
  }
};

/* Segment Bar */
new Chart(document.getElementById('segmentBarChart'), {
  type: 'bar',
  data: { 
    labels: segmentData.labels, 
    datasets: [{ 
      data: segmentData.values, 
      backgroundColor: COLORS,
      borderWidth: 0
    }] 
  },
  options: {
    ...baseOptions,
    scales: { 
      x: { 
        ticks: { 
          maxRotation: 45,
          minRotation: 45,
          font: {
            size: 10
          }
        } 
      },
      y: {
        beginAtZero: true
      }
    }
  }
});

/* Segment Pie */
generatePercentTable('segmentTable', segmentData.labels, segmentData.values, 0);
new Chart(document.getElementById('segmentPieChart'), {
  type: 'pie',
  data: { 
    labels: segmentData.labels, 
    datasets: [{ 
      data: segmentData.values, 
      backgroundColor: segmentData.labels.map((_,i)=>COLORS[i % COLORS.length]),
      borderWidth: 1,
      borderColor: '#fff'
    }] 
  },
  options: {
    ...baseOptions,
    plugins: {
      legend: {
        display: true,
        position: 'right',
        labels: {
          boxWidth: 12,
          font: {
            size: 10
          },
          padding: 15
        }
      }
    }
  }
});

/* Planned Pie */
generatePercentTable('plannedTable', plannedData.labels, plannedData.values, 0);
new Chart(document.getElementById('plannedPieChart'), {
  type: 'pie',
  data: { 
    labels: plannedData.labels, 
    datasets: [{ 
      data: plannedData.values, 
      backgroundColor: plannedData.labels.map((_,i)=>COLORS[i % COLORS.length]),
      borderWidth: 1,
      borderColor: '#fff'
    }] 
  },
  options: {
    ...baseOptions,
    plugins: {
      legend: {
        display: true,
        position: 'right',
        labels: {
          boxWidth: 12,
          font: {
            size: 10
          },
          padding: 15
        }
      }
    }
  }
});

/* Status Bar */
new Chart(document.getElementById('statusBarChart'), {
  type: 'bar',
  data: { 
    labels: statusData.labels, 
    datasets: [{ 
      data: statusData.values, 
      backgroundColor: COLORS.concat(COLORS).slice(0, statusData.labels.length),
      borderWidth: 0
    }] 
  },
  options: {
    ...baseOptions,
    scales: { 
      x: { 
        ticks: { 
          maxRotation: 45,
          minRotation: 45,
          font: {
            size: 10
          }
        } 
      },
      y: {
        beginAtZero: true
      }
    }
  }
});

/* State Bar Horizontal */
new Chart(document.getElementById('stateBarChart'), {
  type: 'bar',
  data: { 
    labels: stateLabels, 
    datasets: [{ 
      data: stateValues, 
      backgroundColor: '#10b981',
      borderWidth: 0
    }] 
  },
  options: {
    ...baseOptions,
    indexAxis: 'y',
    scales: {
      y: {
        ticks: {
          font: {
            size: 11
          }
        }
      },
      x: {
        beginAtZero: true
      }
    }
  }
});
</script>

</body>
</html>
